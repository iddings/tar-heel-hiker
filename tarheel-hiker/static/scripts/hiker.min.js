define("hiker/util",[],function(){var e={};return e.getMediaURL=function(e){return"/asset/media/"+e},e.html=function(){for(var e="",n=0,t=arguments.length;n<t;n++)e+=arguments[n].trim();return e},e}),define("hiker/map",["angular","ol","ResizeSensor"],function(e,n,t){var i=e.module("hiker.map",[]),o=function(){var t=function(){var e=this.vectorSource=new n.source.Vector,i=this.vectorLayer=new n.layer.Vector({source:e,style:function(e){return t.styles[e.get("type")]}});this.map=new n.Map({controls:[],interactions:[],view:new n.View({center:[0,0],zoom:1}),layers:[new n.layer.Tile({source:new n.source.OSM}),i]})};return t.styles={activeNode:new n.style.Style({image:new n.style.Circle({radius:7,snapToPixel:!1,fill:new n.style.Fill({color:"blue"}),stroke:new n.style.Stroke({color:"white",width:2})})}),node:new n.style.Style({image:new n.style.Circle({radius:7,snapToPixel:!1,fill:new n.style.Fill({color:"black"}),stroke:new n.style.Stroke({color:"white",width:2})})})},t.prototype.addNode=function(e){this.vectorSource.addFeature(new n.Feature({type:"node",node:e,geometry:new n.geom.Point(n.proj.fromLonLat([e.location.longitude,e.location.latitude],"EPSG:3857"))}))},t.prototype.addNodes=function(n){var t=this;e.forEach(n,function(e){t.addNode(e)})},t.prototype.setNodes=function(e){this.vectorSource.clear(),this.addNodes(e)},t.prototype.setActiveNode=function(n){e.forEach(this.vectorSource.getFeatures(),function(e){var i=n&&n.id===e.get("node").id?"activeNode":"node";e.setStyle(t.styles[i])})},t.prototype.zoomToNodes=function(){var e=this.vectorSource.getExtent();e.indexOf(1/0)===-1&&this.map.getView().fit(e)},t},r=function(e,n){return{scope:{map:"="},template:"<div></div>",replace:!0,restrict:"E",link:function(i,o,r){var a=i.map instanceof n;return a?(i.map.map.setTarget(o[0]),void new t(o[0],function(){i.map.map.updateSize(),i.map.zoomToNodes()})):void e.error("invalid map object")}}};return i.directive("openlayers",r).factory("olMap",o),i}),define("hiker/media/pano",["angular","hiker/util"],function(e,n){var t=e.module("hiker.media.pano",[]),i=function(){return{restrict:"E",scope:{media:"=component"},controller:function(e,t){e.getMediaURL=n.getMediaURL,e.enterVR=function(){t.enter(e.media)}},template:["<md-content>",'   <div layout="row" layout-align="start center">',"       <span>360&deg; Panorama</span>","       <span flex></span>",'       <md-button class="md-icon-button" ng-click="showViewer()">',"           <md-icon>",'               <ng-md-icon icon="image"></ng-md-icon>',"           </md-icon>","       </md-button>",'       <md-button class="md-icon-button" ng-click="enterVR()">',"           <md-icon>",'               <ng-md-icon icon="google-cardboard"></ng-md-icon>',"           </md-icon>","       </md-button>","   </div>","</md-content>"].join("")}},o=function(t,i,o){var r=this,a=e.element(document.body),d=e.element(['<a-scene vr-mode-ui="enabled: false;">','   <a-sky ng-src="{{ panoUrl }}"></a-sky>',"</a-scene>"].join("")),c=d.children().eq(0);d.css("display","none"),a.append(d),d.on("exit-vr",function(){d.css("display","none")}).on("enter-vr",function(){d.css("display","block")}),r.enter=function(e){c.attr({src:n.getMediaURL(e.filename),visible:"false"}),i.show({clickOutsideToClose:!1,template:["<md-dialog>",'   <md-dialog-content style="overflow-y: hidden;" layout="row" class="md-padding" layout-align="start center">','       <md-progress-circular class="md-padding md-margin" md-radius="100"></md-progress-circular>','       <span class="md-padding">Loading VR Experience</span>',"   </md-dialog-content>","</md-dialog>"].join("")}),c.on("materialtextureloaded",function(){c.attr("visible","true"),i.show({clickOutsideToClose:!1,template:["<md-dialog>",'   <md-dialog-content class="md-padding">',"       This is a placeholder for the VR disclaimer.","   </md-dialog-content>",'   <md-dialog-actions layout="row" layout-align="end">','       <md-button ng-click="cancel()" class="md-warn">Cancel</md-button>','       <md-button ng-click="confirm()" class="md-primary">Let\'s go!</md-button>',"   </md-dialog-actions>","</md-dialog>"].join(""),controller:function(e){e.cancel=function(){i.hide()},e.confirm=function(){i.hide(),d[0].enterVR()}}}),c.off("materialtextureloaded")})}};return t.directive("mediaPano",i).service("vr",o),t}),define("hiker/media",["angular","hiker/media/pano","aframe"],function(e){var n=e.module("hiker.media",["hiker.media.pano"]),t=function(n,t){return{restrict:"AE",scope:{media:"="},link:function(i,o){(i.media.then?i.media:t.resolve(i.media)).then(function(t){var r=e.element("<media-"+t.type+' component="media">');o.append(r),n(r)(i)})}}};return n.directive("media",t),n}),define("hiker/rating",["angular","hiker/util","ngMdIcons"],function(e,n){var t=e.module("hiker.rating",["ngMdIcons"]),i=function(e){var t=5,i=1;return{restrict:"E",scope:{rating:"=stars",ratingArray:"=ratings"},link:function(e,n){var o=function(e){return Math.max(Math.min(e,t),i)};e.starIcons=[],e.$watchGroup(["rating","ratingArray"],function(n){var i=n[0],r=n[1];r&&(i=r.reduce(function(e,n,t){return e+n*(t+1)})/r.reduce(function(e,n){return e+n})),e.disabled=isNaN(i),e.disabled&&(i=t),i=o(i);for(var a,d=Math.round(2*i)/2,c=d%1!==0,s=d-.5*c,l=1;l<=t;l++)a=l<=s?"star":l==s+1&&c?"star_half":"star_border",e.starIcons[l-1]=a})},template:n.html('<div class="rating" layout="row" layout-align="start start" ng-class="{disabled: disabled}">','   <ng-md-icon class="md-no-margin" ng-repeat="icon in starIcons track by $index"','       options=\'{"duration": 1}\' index="{{ $index }}" icon="{{ icon }}">',"   </ng-md-icon>","   <span flex></span>","</div>"),replace:!0}};t.directive("rating",i)}),define("hiker/hike",["angular","ol","hiker/util","ngResource","hiker/map","hiker/media","hiker/rating"],function(e,n,t){var i=e.module("hiker.hike",["ngResource","hiker.map","hiker.media","hiker.rating"]),o=function(){return function(e){return e?e.city+", "+(e.state||e.country):""}},r=function(){return{restrict:"E",template:t.html('<div layout-fill layout="column">',"   <hike-toolbar></hike-toolbar>",'   <div flex layout="row">',"       <hike-sidenav></hike-sidenav>",'       <md-content layout-padding flex md-scroll-y layout="column" layout-gt-sm="row">','           <div layout="column" flex="50">','               <div hide show-gt-sm class="md-padding" layout="column">','                   <span class="md-display-1">{{ hike.title }}</span>','                   <span class="md-headline">',"                       {{ hike.location | location }}","                   </span>",'                   <rating ratings="hike.ratingCounts"></rating>',"               </div>",'               <div layout="column" flex layout-gt-sm="row">','                   <div class="md-padding">','                       <div ng-if="!currentNode" class="plain-text">{{ hike.about }}</div>','                       <div ng-if="currentNode" layout-padding>','                           <div class="md-subhead">Explore <i hide-gt-sm ng-bind="currentNode.title"></i></div>',"                           <div>",'                               <div media="media" ng-repeat="media in currentNode.media"></div>',"                           </div>","                       </div>","                   </div>","               </div>","           </div>",'           <openlayers class="md-padding" flex="50" map="map"></openlayers>',"       </md-content>","    </div>","</div>"),controller:function(e,n,t,i,o,r){var a=!1;e.$on("$stateChangeSuccess",function(n,o,c){e.hike=r.Hike.get(c.hike).then(function(n){e.hike=n,a||(t.all(n.nodes.map(function(e,t){return n.getNode(t)})).then(function(e){d.setNodes(e),d.zoomToNodes()}),a=!0),c.node?n.nodeIds.indexOf(c.node)!=-1?e.currentNode=r.Node.get(c.node).then(function(n){e.currentNode=n,d.setActiveNode(n)}):i.transitionTo("hike",{node:void 0},{notify:!1}):(e.currentNode=null,d.setActiveNode())})});var d=e.map=new o;e.nodeNavIsOpen=function(){var e=n("node-nav",!0);return!!e.isOpen&&e.isOpen()},e.toggleNodeNav=function(){n("node-nav").toggle()}}}},a=function(){return{restrict:"E",template:t.html('<md-toolbar style="z-index: 100;">','   <h1 class="md-toolbar-tools" layout="row">','       <md-button aria-label="Open Menu" hide-gt-sm class="md-icon-button" ng-click="toggleNodeNav()">',"           <md-icon>","               <ng-md-icon icon=\"{{ nodeNavIsOpen() ? 'arrow_back' : 'menu' }}\"></ng-md-icon>","           </md-icon>","       </md-button>","       <span hide show-gt-sm>Tar Heel Hiker</span>",'       <span hide-gt-sm ng-bind="hike.title"></span>',"   </h1>","</md-toolbar>")}},d=function(){return{restrict:"E",template:t.html('<md-sidenav style="height: 100%;" class="md-sidenav-left" md-is-locked-open="$mdMedia(\'gt-sm\')"','   md-whiteframe="4" md-component-id="node-nav">',"   <md-content>","       <div hide-gt-sm md-colors=\"{'background-color': 'primary'}\">","           <md-toolbar></md-toolbar>",'           <div class="md-padding" layout-padding>','               <span class="md-title">{{ hike.location | location }}</span>','               <rating ratings="hike.ratingCounts"></rating>',"           </div>","       </div>",'       <md-list class="md-no-padding" ng-click="toggleNodeNav()">','           <md-list-item aria-label="Hike Overview" ng-href="/hike/{{ hike.slug }}" ng-class="!currentNode ? \'active\' : \'\'">',"               Overview","           </md-list-item>",'           <md-list-item aria-label="{{ node.title }}" ng-repeat="node in hike.nodes" ng-href="/hike/{{ hike.slug }}/{{ node.id }}"',"               ng-class=\"currentNode.id === node.id ? 'active' : ''\">",'               <span ng-bind="node.title"></span>',"           </md-list-item>","       </md-list>","   </md-content>","</md-sidenav>")}},c=function(n,t,i,o){var r="0.1",a=function(e){var n=function(e){return e.split(".").map(parseInt)},t=n(r);e=n(e);for(var i=0,o=t.length;i<o;i++)if(t[i]>e[i])return!1;return!0},d=function(e){return function(){return new(Function.prototype.bind.apply(e,arguments))}},c=function(n){var o=n.cache,r=n.fetchAction||e.noop,d=n.idKey,c=n.resource;return function(e){var n=o.get(e);if(!n){var s={};s[d]=e;var l=c.get(s).$promise.then(function(n){try{a(n.schemaVersion)||t.warn("Using old hike schema:",n)}catch(e){t.warn("Couldn't verify schema version:",n)}return o.put(e,n),r(n),n});return o.put(e,l),l}return i.resolve(n)}},s=function(e){Object.defineProperty(e.prototype,"id",{get:function(){return this._id}})},l=o("/h/:hike?",{hike:"@hike"}),u=o("/m/:media?",{media:"@media"}),m=o("/n/:node?",{node:"@node"}),h=this.Hike=d(l),g=this.Media=d(u),p=this.Node=d(m),f=n("hike-cache"),v=n("media-cache"),k=n("node-cache"),y=function(n){n.media=[],e.forEach(n.mediaIds,function(e,t){n.media.push(g.get(e).then(function(e){return n.media[t]=e,e}))})},b=function(n){n.nodes=[],e.forEach(n.nodeIds,function(e,t){n.nodes.push(p.get(e).then(function(e){return n.nodes[t]=e,e}))})};return l.prototype.getNode=function(e){var n=this.nodes[e];if(n.then)return n;var t=i.defer();return t.resolve(n),t.promise},h.get=c({cache:f,fetchAction:b,idKey:"hike",resource:l}),g.get=c({cache:v,idKey:"media",resource:u}),p.get=c({cache:k,fetchAction:y,idKey:"node",resource:m}),s(l),s(u),s(m),this};return i.directive("hikePage",r).directive("hikeSidenav",d).directive("hikeToolbar",a).filter("location",o).service("resource",c),i}),define("hiker/home",["angular","hiker/util","hiker/hike"],function(e,n){var t=e.module("hiker.home",[]),i=function(){return{restrict:"E",template:n.html()}};return t.directive("hikeHome",i),t}),requirejs(["angular","ngMaterial","ngMdIcons","ui.router","hiker/hike","hiker/home"],function(e){e.module("hiker",["ngMaterial","ngMdIcons","ui.router","hiker.hike","hiker.home"]).config(function(e,n,t){t.strictMode(!1),n.state("home",{url:"/",template:"<hike-home></hike-home>"}).state("hike",{url:"/hike",template:"<hike-page></hike-page>",abstract:!0}).state("hike.overview",{url:"/:hike"}).state("hike.node",{url:"/:hike/:node"}),e.html5Mode(!0)}).config(function(e){var n={"google-cardboard":'<path d="M20.74,6H3.2C2.55,6 2,6.57 2,7.27V17.73C2,18.43 2.55,19 3.23,19H8C8.54,19 9,18.68 9.16,18.21L10.55,14.74C10.79,14.16 11.35,13.75 12,13.75C12.65,13.75 13.21,14.16 13.45,14.74L14.84,18.21C15.03,18.68 15.46,19 15.95,19H20.74C21.45,19 22,18.43 22,17.73V7.27C22,6.57 21.45,6 20.74,6M7.22,14.58C6,14.58 5,13.55 5,12.29C5,11 6,10 7.22,10C8.44,10 9.43,11 9.43,12.29C9.43,13.55 8.44,14.58 7.22,14.58M16.78,14.58C15.56,14.58 14.57,13.55 14.57,12.29C14.57,11.03 15.56,10 16.78,10C18,10 19,11.03 19,12.29C19,13.55 18,14.58 16.78,14.58Z" />'};e.addShapes(n)}),e.bootstrap(document,["hiker"])}),define("main",function(){});